# MCP 클라이언트 시작하기

클라이언트는 MCP 서버와 직접 통신하여 리소스, 도구, 프롬프트를 요청하는 맞춤형 애플리케이션 또는 스크립트입니다. 서버와 상호작용하기 위해 그래픽 인터페이스를 제공하는 검사 도구를 사용하는 것과 달리, 클라이언트를 직접 작성하면 프로그래밍 방식으로 자동화된 상호작용이 가능합니다. 이를 통해 개발자는 MCP 기능을 자신의 워크플로우에 통합하고, 작업을 자동화하며, 특정 요구에 맞춘 맞춤형 솔루션을 구축할 수 있습니다.

## 개요

이 강의에서는 Model Context Protocol (MCP) 생태계 내에서 클라이언트의 개념을 소개합니다. 여러분은 직접 클라이언트를 작성하고 MCP 서버에 연결하는 방법을 배우게 됩니다.

## 학습 목표

이 강의를 마치면 다음을 할 수 있습니다:

- 클라이언트가 할 수 있는 일을 이해하기
- 직접 클라이언트 작성하기
- MCP 서버와 클라이언트를 연결하고 테스트하여 서버가 예상대로 작동하는지 확인하기

## 클라이언트를 작성하려면 무엇이 필요할까요?

클라이언트를 작성하려면 다음을 수행해야 합니다:

- **적절한 라이브러리 가져오기**. 이전에 사용했던 동일한 라이브러리를 사용하지만 다른 구성 요소를 사용합니다.
- **클라이언트 인스턴스화**. 클라이언트 인스턴스를 생성하고 선택한 전송 방식에 연결합니다.
- **리소스를 나열할지 결정하기**. MCP 서버는 리소스, 도구, 프롬프트를 제공하며, 나열할 항목을 결정해야 합니다.
- **클라이언트를 호스트 애플리케이션에 통합하기**. 서버의 기능을 파악한 후, 이를 호스트 애플리케이션에 통합하여 사용자가 프롬프트나 다른 명령을 입력하면 해당 서버 기능이 호출되도록 합니다.

이제 우리가 무엇을 할 것인지 높은 수준에서 이해했으니, 다음으로 예제를 살펴보겠습니다.

### 예제 클라이언트

다음은 예제 클라이언트입니다:

### Python

```python
from mcp import ClientSession, StdioServerParameters, types
from mcp.client.stdio import stdio_client

# Create server parameters for stdio connection
server_params = StdioServerParameters(
    command="mcp",  # Executable
    args=["run", "server.py"],  # Optional command line arguments
    env=None,  # Optional environment variables
)

async def run():
    async with stdio_client(server_params) as (read, write):
        async with ClientSession(
            read, write
        ) as session:
            # Initialize the connection
            await session.initialize()

            # List available resources
            resources = await session.list_resources()
            print("LISTING RESOURCES")
            for resource in resources:
                print("Resource: ", resource)

            # List available tools
            tools = await session.list_tools()
            print("LISTING TOOLS")
            for tool in tools.tools:
                print("Tool: ", tool.name)

            # Read a resource
            print("READING RESOURCE")
            content, mime_type = await session.read_resource("greeting://hello")

            # Call a tool
            print("CALL TOOL")
            result = await session.call_tool("add", arguments={"a": 1, "b": 7})
            print(result.content)


if __name__ == "__main__":
    import asyncio

    asyncio.run(run())
```

위 코드에서 우리는:

- 필요한 라이브러리를 가져오고 서버 매개변수를 설정합니다.
- `stdio_client`를 사용하여 클라이언트 세션을 생성하고 MCP 서버에 연결합니다.
- 서버의 사용 가능한 리소스와 도구를 나열합니다.
- 특정 리소스를 읽고(`greeting://hello`) 도구를 호출합니다(`add`).

이제 MCP 서버와 통신할 수 있는 클라이언트가 완성되었습니다.

다음 연습 섹션에서 각 코드 스니펫을 자세히 살펴보고 어떤 일이 일어나는지 설명해 보겠습니다.

## 연습: 클라이언트 작성하기

앞서 말했듯이, 코드를 설명하는 데 시간을 들이고, 원한다면 직접 코드를 작성하며 따라 해보세요.

### -1- 라이브러리 가져오기

필요한 라이브러리를 가져옵니다. 클라이언트와 선택한 전송 프로토콜(stdio)에 대한 참조가 필요합니다. stdio는 로컬 머신에서 실행되는 것에 적합한 프로토콜입니다. SSE는 다른 전송 프로토콜로, 이후 챕터에서 보여드릴 예정입니다. 지금은 stdio로 계속 진행하겠습니다.

#### Python

```python
from mcp import ClientSession, StdioServerParameters, types
from mcp.client.stdio import stdio_client
```

이제 인스턴스화를 진행해 보겠습니다.

### -2- 클라이언트와 전송 인스턴스화

전송 인스턴스와 클라이언트 인스턴스를 생성해야 합니다:

#### Python

```python
from mcp import ClientSession, StdioServerParameters, types
from mcp.client.stdio import stdio_client

# Create server parameters for stdio connection
server_params = StdioServerParameters(
    command="mcp",  # Executable
    args=["run", "server.py"],  # Optional command line arguments
    env=None,  # Optional environment variables
)

async def run():
    async with stdio_client(server_params) as (read, write):
        async with ClientSession(
            read, write
        ) as session:
            # Initialize the connection
            await session.initialize()

          

if __name__ == "__main__":
    import asyncio

    asyncio.run(run())
```

위 코드에서 우리는:

- 필요한 라이브러리를 가져왔습니다.
- 서버 매개변수 객체를 인스턴스화했습니다. 이를 사용하여 서버를 실행하고 클라이언트와 연결할 수 있습니다.
- `run` 메서드를 정의하여 `stdio_client`를 호출하고 클라이언트 세션을 시작합니다.
- `asyncio.run`에 `run` 메서드를 제공하는 진입점을 생성했습니다.

### -3- 서버 기능 나열하기

이제 프로그램을 실행하면 연결할 수 있는 클라이언트가 생겼습니다. 하지만 실제로 기능을 나열하지는 않으므로 이를 다음 단계에서 추가해 보겠습니다:

#### Python

```python
# List available resources
resources = await session.list_resources()
print("LISTING RESOURCES")
for resource in resources:
    print("Resource: ", resource)

# List available tools
tools = await session.list_tools()
print("LISTING TOOLS")
for tool in tools.tools:
    print("Tool: ", tool.name)
```

여기서 사용 가능한 리소스 `list_resources()`와 도구 `list_tools`를 나열하고 출력합니다.

### -4- 기능 호출하기

기능을 호출하려면 올바른 인수와 경우에 따라 호출하려는 이름을 지정해야 합니다.

#### Python

```python
# Read a resource
print("READING RESOURCE")
content, mime_type = await session.read_resource("greeting://hello")

# Call a tool
print("CALL TOOL")
result = await session.call_tool("add", arguments={"a": 1, "b": 7})
print(result.content)
```

위 코드에서 우리는:

- `read_resource`를 사용하여 `greeting`이라는 리소스를 호출했습니다.
- `call_tool`을 사용하여 `add`라는 도구를 호출했습니다.

### -5- 클라이언트 실행하기

클라이언트를 실행하려면 터미널에서 다음 명령을 입력하세요:

#### Python

다음 명령으로 클라이언트를 호출합니다:

```sh
python client.py
```

## 과제

이번 과제에서는 배운 내용을 활용하여 직접 클라이언트를 생성합니다.

다음은 클라이언트 코드로 호출해야 할 서버입니다. 서버에 더 많은 기능을 추가하여 더 흥미롭게 만들어 보세요.

### Python

```python
# server.py
from mcp.server.fastmcp import FastMCP

# Create an MCP server
mcp = FastMCP("Demo")


# Add an addition tool
@mcp.tool()
def add(a: int, b: int) -> int:
    """Add two numbers"""
    return a + b


# Add a dynamic greeting resource
@mcp.resource("greeting://{name}")
def get_greeting(name: str) -> str:
    """Get a personalized greeting"""
    return f"Hello, {name}!"

```

## 솔루션

**솔루션 폴더**에는 이 튜토리얼에서 다룬 모든 개념을 보여주는 완전한 실행 가능한 클라이언트 구현이 포함되어 있습니다. 각 솔루션에는 클라이언트와 서버 코드가 별도의 독립적인 프로젝트로 구성되어 있습니다.

### 솔루션 구조

솔루션 디렉터리는 다음과 같이 구성되어 있습니다:

```text
solution/
│── client.py        # Main client code
│── server.py        # Compatible server
│── README.md        # Python-specific instructions
```

### 솔루션에 포함된 내용

솔루션은 다음을 제공합니다:

- **완전한 클라이언트 구현**: 튜토리얼의 모든 기능 포함
- **작동하는 프로젝트 구조**: 적절한 종속성과 구성 포함
- **빌드 및 실행 스크립트**: 간편한 설정 및 실행
- **상세한 README**: 지침 포함
- **에러 처리** 및 결과 처리 예제

### 솔루션 사용 방법

1. **폴더로 이동**:

   ```bash
   cd solution/
   ```

2. **폴더의 README 지침을 따르세요**:
   - 종속성 설치
   - 프로젝트 빌드
   - 클라이언트 실행

3. **예상 출력**:

   ```text
   Prompt: Please review this code: console.log("hello");
   Resource template: file
   Tool result: { content: [ { type: 'text', text: '9' } ] }
   ```

전체 문서와 단계별 지침은 다음을 참조하세요: **[솔루션 문서](./solution/README.md)**

## 완전한 예제

이 튜토리얼에서 설명한 모든 기능을 보여주는 완전한 실행 가능한 클라이언트 구현을 제공합니다. 이러한 예제는 참조 구현 또는 자체 프로젝트의 시작점으로 사용할 수 있습니다.

### 제공된 완전한 예제

| 언어       | 파일                          | 설명                                                                 |
|------------|-------------------------------|----------------------------------------------------------------------|
| **Python** | [`client_example_python.py`](./client_example_python.py) | async/await 패턴을 사용하는 완전한 Python 클라이언트                 |
각 완성된 예제는 다음을 포함합니다:

- **연결 설정** 및 오류 처리
- **서버 탐색** (도구, 리소스, 프롬프트 등 필요 시)
- **계산기 작업** (더하기, 빼기, 곱하기, 나누기, 도움말)
- **결과 처리** 및 포맷된 출력
- **포괄적인 오류 처리**
- **깨끗하고 문서화된 코드** (단계별 주석 포함)

### 완성된 예제로 시작하기

1. 위 표를 참고하세요.
2. **완성된 예제 파일을 검토**하여 전체 구현을 이해하세요.
3. [`complete_examples.md`](./complete_examples.md)의 지침을 따라 **예제를 실행**하세요.
4. **예제를 수정 및 확장**하여 특정 사용 사례에 맞게 조정하세요.

이 예제를 실행하고 커스터마이징하는 방법에 대한 자세한 문서는 [완성된 예제 문서](./complete_examples.md)를 참조하세요.

### 솔루션 vs. 완성된 예제

| **솔루션 폴더** | **완성된 예제** |
|--------------------|--------------------- |
| 빌드 파일이 포함된 전체 프로젝트 구조 | 단일 파일 구현 |
| 종속성을 포함하여 바로 실행 가능 | 집중된 코드 예제 |
| 프로덕션 환경과 유사한 설정 | 교육용 참고 자료 |
| 도구 지원 | 비교 |

두 접근법 모두 유용합니다 - **솔루션 폴더**는 전체 프로젝트에 적합하며, **완성된 예제**는 학습 및 참고용으로 사용하세요.

## 주요 요점

이 챕터의 주요 요점은 클라이언트에 대한 다음 내용입니다:

- 서버에서 기능을 탐색하고 호출하는 데 사용할 수 있습니다.
- 클라이언트는 자체적으로 시작하면서 서버를 시작할 수 있지만, 실행 중인 서버에 연결할 수도 있습니다.
- 이전 챕터에서 설명한 Inspector와 같은 대안과 함께 서버 기능을 테스트하는 훌륭한 방법입니다.

## 추가 자료

- [MCP에서 클라이언트 빌드하기](https://modelcontextprotocol.io/quickstart/client)

## 다음 단계

- 다음: [LLM을 사용하는 클라이언트 만들기](<../3-3. LLM-클라이언트/3-3.md>)